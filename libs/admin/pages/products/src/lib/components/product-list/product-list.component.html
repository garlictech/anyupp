<nb-card class="h-100 mb-0">
  <nb-card-header>
    <div class="float-left">
      {{ 'products.listTitle' | translate }}
    </div>

    <div class="float-right">
      <bgap-active-product-category-selector
        class="float-right"
      ></bgap-active-product-category-selector>
      <button
        [disabled]="selectedProductLevel !== eProductLevel.CHAIN || !selectedProductCategoryId"
        nbButton
        class="float-right mr-2"
        type="button"
        shape="round"
        size="small"
        (click)="addProduct()"
      >
        <nb-icon icon="plus-outline"></nb-icon>
      </button>
    </div>
  </nb-card-header>
  <nb-card-body class="p-2">
    <nb-tabset (changeTab)="selectLevel($event)" fullWidth #tabset>
      <nb-tab
        [tabTitle]="'products.chainProducts' | translate"
        [tabId]="eProductLevel.CHAIN"
        [active]="selectedProductLevel === eProductLevel.CHAIN"
        [disabled]="!selectedChainId"
      >
        <ng-container *ngFor="let product of chainProducts$ | async">
          <nb-list-item
            *ngIf="product.productCategoryId === selectedProductCategoryId"
          >
            <bgap-product-list-item
              class="w-100"
              [product]="product"
              [productLevel]="eProductLevel.CHAIN"
              [currency]="groupCurrency"
            ></bgap-product-list-item>
          </nb-list-item>
        </ng-container>
      </nb-tab>
      <nb-tab
        [tabTitle]="'products.groupProducts' | translate"
        [tabId]="eProductLevel.GROUP"
        [active]="selectedProductLevel === eProductLevel.GROUP"
        [badgeText]="
          (pendingGroupProducts || []).length > 0 && selectedGroupId
            ? pendingGroupProducts.length.toString()
            : ''
        "
        badgeStatus="danger"
        [disabled]="!selectedGroupId"
      >
        <ng-container *ngIf="selectedGroupId">
          <nb-list-item *ngFor="let product of pendingGroupProducts">
            <bgap-product-list-item
              class="w-100"
              [pending]="true"
              [product]="product"
              [productLevel]="eProductLevel.GROUP"
              [currency]="groupCurrency"
            ></bgap-product-list-item>
          </nb-list-item>
          <nb-list-item *ngFor="let product of groupProducts$ | async">
            <bgap-product-list-item
              class="w-100"
              [pending]="false"
              [product]="product"
              [productLevel]="eProductLevel.GROUP"
              [currency]="groupCurrency"
            ></bgap-product-list-item>
          </nb-list-item>
        </ng-container>
      </nb-tab>
      <nb-tab
        [tabTitle]="'products.unitProducts' | translate"
        [tabId]="eProductLevel.UNIT"
        [active]="selectedProductLevel === eProductLevel.UNIT"
        [badgeText]="
          (pendingUnitProducts || []).length > 0 && selectedUnitId
            ? pendingUnitProducts.length.toString()
            : ''
        "
        badgeStatus="danger"
        [disabled]="!selectedUnitId"
      >
        <ng-container *ngIf="selectedUnitId">
          <nb-list-item *ngFor="let product of pendingUnitProducts">
            <bgap-product-list-item
              class="w-100"
              [pending]="true"
              [product]="product"
              [productLevel]="eProductLevel.UNIT"
              [currency]="groupCurrency"
            ></bgap-product-list-item>
          </nb-list-item>
          <nb-list-item
            *ngFor="
              let product of unitProducts;
              first as isFirst;
              last as isLast
            "
          >
            <bgap-product-list-item
              class="w-100"
              [product]="product"
              [productLevel]="eProductLevel.UNIT"
              [currency]="groupCurrency"
              (positionChange)="unitProductPositionChange($event)"
              [isFirst]="isFirst"
              [isLast]="isLast"
            ></bgap-product-list-item>
          </nb-list-item>
        </ng-container>
      </nb-tab>
    </nb-tabset>
  </nb-card-body>
</nb-card>
