<nb-card>
  <nb-card-header>
    <div class="float-start">
      {{ (unit?.id ? 'units.editUnit' : 'units.newUnit') | translate }}
    </div>
    <button
      nbButton
      ghost
      shape="round"
      size="small"
      class="float-right"
      (click)="close()"
    >
      <nb-icon icon="close" pack="material-icons"></nb-icon>
    </button>
  </nb-card-header>
  <nb-card-body>
    <form [formGroup]="dialogForm!" (ngSubmit)="submit()" autocomplete="off">
      <div class="row" *ngIf="unit">
        <div class="col-md-12">
          <bgap-form-static-text
            caption="common.id"
            [value]="unit.id"
            inputId="unitId"
          ></bgap-form-static-text>
        </div>
      </div>
      <div class="row">
        <div class="col-md-5">
          <bgap-form-text-input
            caption="common.name"
            type="text"
            [control]="dialogForm.get('name')! | asFormControl"
            inputId="name"
          ></bgap-form-text-input>
        </div>
        <div class="col-md-4">
          <bgap-form-select
            caption="common.group"
            [options]="(groupOptions$ | async) || []"
            [control]="dialogForm.get('groupId')! | asFormControl"
            [localize]="false"
            inputId="groupId"
          ></bgap-form-select>
        </div>
        <div class="col-md-3">
          <bgap-form-select
            caption="common.orderPolicy.title"
            [options]="orderPolicyOptions"
            [control]="dialogForm.get('orderPolicy')! | asFormControl"
            [localize]="false"
            inputId="orderPolicy"
          ></bgap-form-select>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <bgap-form-text-input
            caption="common.descriptionHU"
            type="text"
            [control]="
              dialogForm.get('description')!.get('hu')! | asFormControl
            "
            inputId="descriptionHu"
          ></bgap-form-text-input>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <bgap-form-text-input
            caption="common.descriptionEN"
            type="text"
            [control]="
              dialogForm.get('description')!.get('en')! | asFormControl
            "
            inputId="descriptionEn"
          ></bgap-form-text-input>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <bgap-form-text-input
            caption="common.descriptionDE"
            type="text"
            [control]="
              dialogForm.get('description')!.get('de')! | asFormControl
            "
            inputId="descriptionDe"
          ></bgap-form-text-input>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4">
          <bgap-form-select
            caption="common.timeZone"
            [options]="timeZoneOptions"
            [control]="dialogForm.get('timeZone')! | asFormControl"
            [localize]="false"
            inputId="timeZone"
          ></bgap-form-select>
        </div>

        <div class="col-md-3">
          <bgap-form-text-input
            caption="units.openFrom"
            type="date"
            [control]="dialogForm.get('open')!.get('from')! | asFormControl"
            inputId="openFrom"
          ></bgap-form-text-input>
        </div>
        <div class="col-md-3">
          <bgap-form-text-input
            caption="units.openTo"
            type="date"
            [control]="dialogForm.get('open')!.get('to')! | asFormControl"
            inputId="openTo"
          ></bgap-form-text-input>
        </div>

        <div class="col-md-2 pt-4">
          <bgap-form-checkbox
            caption="common.isActive"
            [control]="dialogForm.get('isActive')! | asFormControl"
            inputId="isActive"
          ></bgap-form-checkbox>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4">
          <bgap-form-text-input
            caption="common.packagingTax"
            type="number"
            [control]="
              dialogForm.get('packagingTaxPercentage')! | asFormControl
            "
            inputId="packagingTaxPercentage"
          ></bgap-form-text-input>
        </div>
      </div>

      <fieldset class="form">
        <legend class="label">
          {{ 'common.paymentModes.title' | translate }}
        </legend>

        <div>
          <nb-checkbox
            class="me-5 mb-3"
            [checked]="paymentModeIsChecked(paymentMode)"
            (checkedChange)="togglePaymentMode(paymentMode)"
            *ngFor="let paymentMode of paymentModes"
          >
            <label class="caption">
              {{ paymentMode.caption! | translate }}</label
            >
          </nb-checkbox>
        </div>
      </fieldset>

      <bgap-form-order-mode
        [control]="dialogForm.get('supportedOrderModes')! | asFormControl"
        [orderModes]="orderModes"
      ></bgap-form-order-mode>

      <bgap-form-serving-mode
        [control]="dialogForm.get('supportedServingModes')! | asFormControl"
        [servingModes]="servingModes"
      ></bgap-form-serving-mode>

      <bgap-form-contact-group
        [contactFormGroup]="dialogForm | asFormGroup"
      ></bgap-form-contact-group>

      <bgap-form-weekly-schedule
        [scheduleControl]="dialogForm.get('openingHours')! | asFormControl"
      ></bgap-form-weekly-schedule>

      <bgap-form-unit-lanes
        [lanesFormArray]="dialogForm.get('lanes')! | asFormArray"
      ></bgap-form-unit-lanes>

      <bgap-form-rating-policy
        [ratingPoliciesFormArray]="
          dialogForm.get('ratingPolicies')! | asFormArray
        "
      ></bgap-form-rating-policy>

      <bgap-form-unit-pos
        *ngIf="!unit"
        [posFormGroup]="dialogForm.get('pos')! | asFormGroup"
        [externalIdControl]="dialogForm.get('externalId')! | asFormControl"
        [editing]="false"
        (changePasswordEmitter)="generatePassword()"
      ></bgap-form-unit-pos>

      <div class="mt-20">
        <button
          nbButton
          size="small"
          type="submit"
          fullWidth
          status="primary"
          [disabled]="dialogForm.invalid"
        >
          {{ 'common.submit' | translate }}
        </button>
      </div>
    </form>
  </nb-card-body>
</nb-card>
